---
title: "Performance Checks"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Performance Checks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## The price we pay

So the price for using these abstractions reduces mainly to the overhead 
generated by casting formulas into functions; and additionally to the overhead
generated by S4 dispatch. This abviously is not such a problem when the time
applying the function itself increases -- either by computation time or number
if iterations.

```{r}
library("microbenchmark")

microbenchmark(
  flatmap(1:3, x ~ x^2),
  sapply(1:3, function(x) x^2),
  sapply(1:3, as.function(x ~ x^2)),
  flatmap(1:3, function(x) x^2)
)

microbenchmark(
  flatmap(1:1e4, x ~ x^2),
  sapply(1:1e4, function(x) x^2)
)
```

The same can be seen for the multivariate map implementation:

```{r}
microbenchmark(
  flatmap(1:3 ~ 1:3, f(x, y) ~ x + y),
  mapply(function(x, y) x + y, 1:3, 1:3),
  mapply(as.function(f(x, y) ~ x + y), 1:3, 1:3)
)
```

